<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AWS Marketplace Local Test</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .form-group { margin-bottom: 10px; }
    label { display: block; margin-bottom: 5px; font-weight: bold; }
    input, textarea { width: 300px; padding: 8px; }
    button { padding: 10px 20px; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>ðŸ§ª AWS Marketplace Local Test</h2>

  <!-- Step 1: AWS Token -->
  <form id="tokenForm">
    <label>AWS Marketplace Token:</label>
    <input type="text" id="token" name="x-amzn-marketplace-token" required>
    <button type="submit">Resolve Customer</button>
  </form>

  <pre id="awsResponse"></pre>

  <hr>

  <!-- Step 2: Your actual AWS form -->
  <form id="awsForm" style="display:none;">
    <div class="form-group">
      <label>Name*</label>
      <input type="text" name="name" placeholder="Your Name" required>
    </div>

    <div class="form-group">
      <label>ZIP Code*</label>
      <input type="text" name="zip" placeholder="ZIP Code" required>
    </div>

    <div class="form-group">
      <label>Phone Number*</label>
      <input type="tel" name="phone" placeholder="Phone Number" required>
    </div>

    <div class="form-group">
      <label>Company Information*</label>
      <input type="text" name="company" placeholder="Company Name / Info" required>
    </div>

    <div class="form-group">
      <label>Email*</label>
      <input type="email" name="email" placeholder="Email Address" required>
    </div>

    <div class="form-group">
      <label>Product Setup Preferences</label>
      <textarea name="preferences" placeholder="Tell us about your setup preferences..."></textarea>
    </div>

    <button type="submit">Submit</button>
  </form>

  <pre id="salesforceResponse"></pre>

  <script>
    let awsData = null;

    // STEP 1: Mock AWS token resolve
    document.querySelector("#tokenForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData();
      formData.append("x_amzn_marketplace_token", document.querySelector("#token").value);

      const res = await fetch("http://127.0.0.1:8000/resolve-customer", {
        method: "POST",
        body: formData
      });

      const data = await res.json();
      awsData = data.aws_customer;
      document.querySelector("#awsResponse").innerText = JSON.stringify(data, null, 2);

      // show main form
      document.querySelector("#awsForm").style.display = "block";
    });

    // STEP 2: Send form + AWS info to backend
    document.querySelector("#awsForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const form = e.target;
      const payload = {
        name: form.name.value,
        zip: form.zip.value,
        phone: form.phone.value,
        company: form.company.value,
        email: form.email.value,
        preferences: form.preferences.value,
        aws_customer_info: awsData
      };

      const res = await fetch("http://127.0.0.1:8000/submit-form", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const result = await res.json();
      document.querySelector("#salesforceResponse").innerText = JSON.stringify(result, null, 2);
    });
  </script>
</body>
</html>
